(self.webpackChunk_deathbeds_ipydrawio_pdf=self.webpackChunk_deathbeds_ipydrawio_pdf||[]).push([[514],{869:(t,i,n)=>{"use strict";n.d(i,{M:()=>r,C:()=>s});var e=n(733);const s=new(n(802).LabIcon)({name:"drawio:pdf",svgstr:e.DRAWIO_ICON_SVG.replace(e.DRAWIO_ICON_CLASS_RE,"jp-icon-contrast2")}),r={ext:".pdf",format:"base64",factoryName:"Diagram (PDF)",icon:s,key:"pdf",label:"PDF",mimetype:"application/pdf",modelName:"base64",name:"pdf",isExport:!0,isBinary:!0,isTransformed:!0,save:function(t){return t.split(",")[1]},exporter:async(t,i,n)=>null}},514:(t,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>v});var e=n(520),s=n(106),r=n(733),o=n(869),a=n(271),d=n.n(a);function l(t){const{provisioning:i,provisioned:n,running:e,starting:r}=t;let a=i?"provisioning...":r?"starting...":e?"running":n?"ready":"not provisioned";return d().createElement(s.GroupItem,{spacing:4},d().createElement(s.TextItem,{source:a,title:`Drawio PDF export server is ${a}`}),d().createElement(o.C.react,{stylesheet:"statusBar"}))}class u extends e.VDomRenderer{constructor(t){super(t),this.addClass(s.interactiveItem)}render(){return null==this.model?null:d().createElement(l,{provisioned:this.model.provisioned,running:this.model.running,provisioning:this.model.provisioning,starting:this.model.starting})}}!function(t){class i extends e.VDomModel{constructor(){super(...arguments),this._provisioned=!1,this._running=!1,this._provisioning=!1,this._starting=!1}get provisioned(){return this._provisioned}set provisioned(t){this._provisioned!==t&&(this._provisioned=t,this.stateChanged.emit(void 0))}get running(){return this._running}set running(t){this._running!==t&&(this._running=t,this.stateChanged.emit(void 0))}get starting(){return this._starting}set starting(t){this._starting!==t&&(this._starting=t,this.stateChanged.emit(void 0))}get provisioning(){return this._starting}set provisioning(t){this._provisioning!==t&&(this._provisioning=t,this.stateChanged.emit(void 0))}}t.Model=i}(u||(u={}));var c,p=n(629);class h{constructor(){this.exportPDF=async(t,i,n)=>{await this.fetchStatus();let e=this.exportUrl(n);if(null==e)return null;const s=t.adapter.toXML();e+=e.endsWith("/")?"":"/";const r=new URLSearchParams;r.append("xml",s),r.append("format","pdf"),r.append("base64","1");const o=await fetch(e,{method:"POST",headers:this.defaultHeaders(),body:r.toString()});return o.status>=400?(console.warn("PDF export failed",o),null):`application/pdf;base64,${await o.text()}`},this.status=new u.Model}async fetchStatus(){const t=this.statusUrl();if(null==t)return;const i=await fetch(t,{method:"GET"});if(i.status>=400)return console.warn("Unknown PDF status",i),null;const n=await i.json();this.status.running=n.is_running,this.status.provisioned=n.is_provisioned,this.status.provisioning=n.is_provisioning,this.status.starting=n.is_starting}async provision(){await this.fetchStatus();const t=this.provisionUrl();if(null==t)return;const i=fetch(t,{method:"POST",headers:this.defaultHeaders()});await this.fetchStatus();const n=await i;if(n.status>=400)return console.warn("PDF provision failed",n),null;await this.fetchStatus()}defaultHeaders(){return{"Content-Type":"application/x-www-form-urlencoded","X-XSRFToken":c.getCookie("_xsrf")||""}}exportUrl(t){let i="./ipydrawio/export/";try{i=t.composite.drawioExportUrl.url}catch(t){r.DEBUG&&console.warn("using fallback url",t)}return 0!==i.indexOf("./")?(console.error("don't know how to handle non-relative URLs"),null):`${p.PageConfig.getBaseUrl()}${i.slice(2)}`}statusUrl(){let t="./ipydrawio/status";return 0!==t.indexOf("./")?(console.error("don't know how to handle non-relative URLs"),null):`${p.PageConfig.getBaseUrl()}${t.slice(2)}`}provisionUrl(){let t="./ipydrawio/provision";return 0!==t.indexOf("./")?(console.error("don't know how to handle non-relative URLs"),null):`${p.PageConfig.getBaseUrl()}${t.slice(2)}`}}!function(t){t.getCookie=function(t){const i=document.cookie.match("\\b"+t+"=([^;]*)\\b");return null==i?void 0:i[1]}}(c||(c={}));var g=n(36);const v={activate:function(t,i,n,e){const s=new h;if(n.addFormat(Object.assign(Object.assign({},o.M),{exporter:s.exportPDF})),t.commands.addCommand(g.OF.provision,{label:"Provision Drawio PDF Export Server",execute:async()=>{await s.provision()}}),i.addItem({command:g.OF.provision,category:"Diagram Export"}),e){const t=new u(s.status);e.registerStatusItem(`${g.NS}:status`,{item:t,align:"right",rank:4,isActive:()=>null!=n.activeWidget}),s.fetchStatus().catch(console.warn)}},id:g.Uu,requires:[e.ICommandPalette,r.IDiagramManager],optional:[s.IStatusBar],autoStart:!0}},36:(t,i,n)=>{"use strict";n.d(i,{NS:()=>e,Uu:()=>s,sr:()=>r,OF:()=>o});const e="@deathbeds/ipydrawio-pdf",s=`${e}:plugin`,r="ipydrawio-pdf";var o;!function(t){t.provision=`${r}:provision`}(o||(o={}))}}]);