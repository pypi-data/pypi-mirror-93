import cytoscape from"https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.17.1/cytoscape.esm.min.js";import Fuse from"https://cdn.jsdelivr.net/npm/fuse.js@6.4.3/dist/fuse.esm.js";var SlipboxCollection_1=class{constructor(){this.cy=cytoscape({headless:!0})}addNote(e){const t=document.getElementById(e),n=t.querySelector("h1").textContent,s=t.getAttribute("data-filename");this.cy.add({data:{id:e,title:n,filename:s,label:n,bgColor:"gray"}})}addLink(e,t,n){const s=`${e}-${t}${n}`;this.cy.add({data:{id:s,source:e,target:t,tag:n}})}colorEntrypoints(){this.cy.nodes((e=>0===e.indegree(!1)&&e.outdegree(!1)>0)).data("bgColor","#4444aa")}};function graphArea(){const e=document.createElement("div");return e.innerHTML='\n    <div class="slipbox-graph-cytoscape"></div>\n    <div class="slipbox-graph-info">\n      <header>\n        <h3><a href=""></a></h3>\n        <p></p>\n      </header>\n    </div>\n  ',e}function clusterElements(e,t){const n=e.cy.edges(`[tag="${t}"]`);return n.connectedNodes().union(n.filter((e=>e.data("source")!==e.data("target"))))}function neighborElements(e,t){const n=e.cy.getElementById(t),s=new Set,o=n.incomers().edges("edge[tag]");for(;o.length>0;){const e=o.pop(),t=e.data("tag");s.has(e)||(o.push(...e.source().incomers(`edge[tag="${t}"]`)),s.add(e))}const r=new Set,c=n.outgoers().edges("edge[tag]");for(;c.length>0;){const e=c.pop(),t=e.data("tag");r.has(e)||(c.push(...e.target().outgoers(`edge[tag="${t}"]`)),r.add(e))}const a=e.cy.collection().union(Array.from(s)).union(Array.from(r)),i=a.connectedNodes(),l=n.openNeighborhood(),d=i.union(a).union(l).filter((e=>e.isNode()||e.data("source")!==e.data("target"))),h=d.getElementById(t).clone();return h.data("bgColor","black"),h.union(d)}function createCytoscape(e){const t=cytoscape({container:e.querySelector(".slipbox-graph-cytoscape"),selectionType:"additive",style:[{selector:"node",style:{label:"data(label)",height:"label",width:"label",padding:"8px",shape:"round-rectangle",color:"white","background-color":"data(bgColor)","text-halign":"center","text-valign":"center","text-wrap":"wrap","text-max-width":100}},{selector:"edge",style:{width:2,"curve-style":"bezier","line-color":"black","line-style":"solid","target-arrow-color":"black","target-arrow-shape":"triangle"}}]}),[n,s]=hoverHandlers(e);return t.on("select","node",n),t.on("unselect","node",s),t}function renderCytoscape(e,t="breadthfirst"){return"cose"===t?e.layout({name:"cose",nodeDimensionsIncludeLabels:!0,numIter:300,fit:!0}).run():e.layout({name:"breadthfirst",spacingFactor:1,fit:!0,directed:!0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!0}).run(),e}function hoverHandlers(e){const t=e.querySelector(".slipbox-graph-info"),n=t.querySelector("header a"),s=t.querySelector("header p");return[e=>{const t=e.target.data("id");n.textContent=e.target.data("title"),n.href="#"+t,s.textContent=e.target.data("filename"),e.target.data("label",t)},e=>{n.textContent="",s.textContent="",e.target.data("label",e.target.data("title"))}]}var init=function(e){e.colorEntrypoints();const t=document.createElement("div");function n(){t.style.display="none";const n=window.location.hash.slice(1);let s=[],o="breadthfirst";if(n){const t=Number(n);if(Number.isInteger(t)){if(s=neighborElements(e,n),s.length<2)return}else s=clusterElements(e,n)}else s=e.cy.elements().filter((e=>e.isNode()||e.data("source")!==e.data("target"))),s.length>30&&(o="cose");if(0===s.length)return;t.style.display="block",t.innerHTML="";const r=createCytoscape(t.appendChild(graphArea()));r.add(s),renderCytoscape(r,o)}document.querySelector(".slipbox-bottom").appendChild(t),n(),window.addEventListener("hashchange",n)},graph={SlipboxCollection:SlipboxCollection_1,init:init},init$1=function(){const e=document.querySelectorAll("ol.slipbox-list > li[value]");for(let t=0;t<e.length;t++){const n=e[t],s=n.value,o=document.querySelector(`section.slipbox-note[id="${s}"]`);if(!o){n.remove();continue}const r=o.querySelector("h1");if(!r){n.remove();continue}const c=document.createElement("a");c.href=`#${s}`,c.innerHTML=r.innerHTML,n.appendChild(c)}},list={init:init$1};class Search{constructor(e,t=null){this.fuse=new Fuse(e,t||{includeMatches:!0,ignoreLocation:!0,keys:["textContent"],threshold:.45})}render(e){e.input.addEventListener("change",(()=>{window.location.hash="#search";const t=this.fuse.search(e.input.value);e.results.textContent="";for(const n of t){const t=n.item.querySelector("h1");if(!t)continue;const s=t.textContent,o=document.createElement("h3");o.innerHTML=`<a href="#${n.item.id}">${s}</a>`;const r=document.createElement("p");r.appendChild(o);let c=3;for(const e of n.item.children){const t=e.cloneNode(!0);if(c--<=0)break;"H1"===t.tagName&&t.textContent===s||r.appendChild(t)}e.results.appendChild(r),e.results.appendChild(document.createElement("hr"))}}))}}var init$2=function(){const e=Array.from(document.getElementsByClassName("slipbox-note"));new Search(e).render({results:document.querySelector("#search > .search-results"),input:document.querySelector('nav input[type="text"]')})},search={init:init$2};function getScore(e){return Number(window.localStorage.getItem(`${e}.score`))}function setScore(e,t){window.localStorage.setItem(`${e}.score`,t)}function getTotal(e){return Number(window.localStorage.getItem(`${e}.total`))}function setTotal(e,t){window.localStorage.setItem(`${e}.total`,t)}function getRecent(e){return window.localStorage.getItem(`${e}.recent`)}function popRecent(e){const t=getRecent(e)||"";window.localStorage.setItem(`${e}.recent`,t.slice(0,t.length-1))}function pushRecent(e,t){const n=window.localStorage.getItem(`${e}.recent`);window.localStorage.setItem(`${e}.recent`,n+(t?"1":"0"))}function shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1)),s=e[t];e[t]=e[n],e[n]=s}}var Flashcard_1=class{constructor(e){this.pressed=null,this.container=e,window.addEventListener("hashchange",(()=>{this.pressed=null,this.render()}))}pressUp(e){const t=getScore(e),n=getTotal(e);switch(this.pressed){case"up":this.pressed=null,setScore(e,t-1),setTotal(e,n-1),popRecent(e);break;case"down":this.pressed="up",setScore(e,t+1),popRecent(e),pushRecent(e,!0);break;default:this.pressed="up",setScore(e,t+1),setTotal(e,n+1),pushRecent(e,!0)}this.render()}pressDown(e){const t=getScore(e),n=getTotal(e);switch(this.pressed){case"up":this.pressed="down",setScore(e,t-1),popRecent(e),pushRecent(e,!1);break;case"down":this.pressed=null,setTotal(e,n-1),popRecent(e);break;default:this.pressed="down",setTotal(e,n+1),pushRecent(e,!1)}this.render()}render(){this.container.classList.add("slipbox-srs"),this.container.innerHTML="";const e=window.location.hash.slice(1);if(!e||!Number.isInteger(Number(e)))return;this.container.innerHTML=`\n      <button class="slipbox-srs-down">▼</button>\n      <span class="slipbox-srs-score">${getScore(e)}</span>\n      out of\n      <span class="slipbox-srs-total">${getTotal(e)}</span>\n      <button class="slipbox-srs-up">▲</button>\n    `;const t=this.container.querySelector(".slipbox-srs-down"),n=this.container.querySelector(".slipbox-srs-up"),s=this.container.querySelector(".slipbox-srs-score"),o=this.container.querySelector(".slipbox-srs-total");switch(n.addEventListener("click",(()=>this.pressUp(e))),t.addEventListener("click",(()=>this.pressDown(e))),this.pressed){case"up":n.classList.add("slipbox-srs-pressed"),t.classList.remove("slipbox-srs-pressed");break;case"down":n.classList.remove("slipbox-srs-pressed"),t.classList.add("slipbox-srs-pressed");break;default:n.classList.remove("slipbox-srs-pressed"),t.classList.remove("slipbox-srs-pressed")}s.textContent=getScore(e),o.textContent=getTotal(e)}},Scheduler_1=class{constructor(e,t){this.sched=[],this.ids=t,this.container=e}isReady(e){let t=getRecent(e)||"";t.length>8&&(t=t.slice(t.length-8,t.length));const n=Array.from(t).reduce(((e,t)=>"0"===t?e:e+1),0);return window.localStorage.setItem(`${e}.recent`,t),Math.random()<=2**-n}schedule(){if(this.sched.length>0)return this;shuffle(this.ids);for(const e of this.ids)this.isReady(e)&&this.sched.push(e);return this}render(){this.container.addEventListener("click",(()=>{this.container.href="#"+this.next()}))}next(){for(;0===this.sched.length;)this.schedule();return this.sched.pop()}},_getRecent=getRecent,srs={Flashcard:Flashcard_1,Scheduler:Scheduler_1,_getRecent:_getRecent};function initSRS(e){const t=document.createElement("div");document.querySelector(".slipbox-bottom").appendChild(t),new srs.Flashcard(t).render(),new srs.Scheduler(document.querySelector('nav a[href="#random"]'),e.cy.nodes().map((e=>e.data("id")))).render()}window.slipbox=new graph.SlipboxCollection,window.initSlipbox=function(){const e=document.getElementById("title-block-header");e&&e.remove(),list.init(),search.init(),initSRS(window.slipbox),graph.init(window.slipbox)};var src={};export default src;