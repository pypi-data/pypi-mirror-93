(this.webpackJsonpdrawable_canvas=this.webpackJsonpdrawable_canvas||[]).push([[0],{20:function(t,e,a){t.exports={enabled:"CanvasToolbar_enabled__SWSrD",disabled:"CanvasToolbar_disabled__3XcYr",invertx:"CanvasToolbar_invertx__3CHU-"}},21:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAwwAAAMMBnc7+MwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEFSURBVEiJ7dSxLkRBFMbx31BIlkQlHoCap5BQLAXvQafV6DyLRLYSdkWv0dBQ0NAKkUhkj2bEzc3udW9xE5E9yVfNd85/5pyZSRGhzZhqtfoE8DcAKaVOqwD0mkBSSnNNAAmBAboR8V4qtoguVrNWMI9n3Gad4SQqHlRk9dHJvmns4qWwXqUrbESEspSMfazhekyhN9zhc8z6KWarAKN0jm0sI+WkmdyuPTyV/JdFSBXgATujjl3aYQf7+CjkXhTaPRYw+DbVETZLkMM6Leo3hGxhmHNfsVBnBk0hx4XcozqARpA8/GG+bQcJ6+rFTUQ81jGmlJYi4p6fa9da/IPvegL4Lb4A0uc9nRaYXwcAAAAASUVORK5CYII="},26:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAhQAAAIUB4uz/wQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHUSURBVEiJtda9ahRRFAfw3xHFJCabFEkawcYiYKMWVmohBHwFOwsfQLCxthOENHZqKxZG8DHSxcJC0Qcw7AqSNSoGci3mznp3nP0K8cBlZs7X/5z//RopJeMGlrGL1Bi7WJ4Uf9pk2cQVPMDPrJvHVra9GRc8BBARS7iKU4X6cn5+wvf8vljbIuJr4XuEdyml/YGmoGIdX/xLxayji/U2iu5iJXfwa1zbY2QOOznXE4YpuoE93D5m8lr2cLMN4BWu4TF+4HDGxIEOeng90DaW5BkVj/fyd6dhP4u5hq6Tnxdz7GZpL1eLlNIhvmEtq7Yj4mHhsoWng5Ir23b+rGO6Zc62fdAtnFewUdjOqyaylo3sMxJgqIMsvcJ5X8XrKFlCvwHQmwRQdjArwH5K6fc0AKvHAFjVoGcUwCwUdbKPHNNrOpw0RVN10MVCRCz8T4A6oI/FiIiTBKh5XFN1EDnRkETEnGrnH2sOSoC60rbqoR8R8zg3bQe102oB0DYPAwB/l/VkgJTSgeo+KDtoA6h1fSN2Me1nUV3JOj7iOT5k/csi5jNe4D2uj+og8lE7rIx4hjt4hIMRRZRyX7UYLqWUjoYsI35VLuCt6tKZ5h7ewa22XH8AgjMTispa6ucAAAAASUVORK5CYII="},27:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEYSURBVEiJ7dS9SgNBFMXxX0y0NNpLqjQiKRRETON7aBMfwLfxDcRGC8HOTm21s7RIYZdniGiRO+6y5mNXVxD0wMBw58z532Fnh1+kFq5jNH8C0MFbjE7ZTUsVAEsz5rUBvqR/wB8CNLFeY+5aZH4ArjDCXsHYNv+vbWK1UNuNrMs8oGfyFGzmjDthvA9QUe1YG4U3aQvL2M4DpqkRHfZxU4C0o9aPxhpzcsDQ5I0ZFOpHGMfas+wtSvNxePIaxNpw0QngHIcR1M3Vu3jFcXhmqsw1vZCdJCmFny3a3CoBSBAm3TbKhlcBJEj6Vo9lN1UBwENF/yfAAVaqhhS0P614J7uCdY1bsh+kh1NsfLP7pBec4KmmvNl6B0BuQt0zCQ0xAAAAAElFTkSuQmCC"},28:function(t,e,a){t.exports=a(45)},40:function(t,e){},41:function(t,e){},42:function(t,e){},44:function(t,e,a){},45:function(t,e,a){"use strict";a.r(e);var n=a(7),o=a.n(n),r=a(24),i=a.n(r),c=a(9),s=a(17),u=a(11),l=a(14),h=a(20),f=a.n(h),d=a(26),v=a.n(d),S=a(21),b=a.n(S),A=a(27),k=a.n(A),m=function(t){var e=t.imgUrl,a=t.altText,n=t.invertX,r=t.size,i=t.enabled,c=t.clickCallback;return o.a.createElement("img",{src:e,className:"\n    ".concat(i?f.a.enabled:f.a.disabled," ").concat(n?"":f.a.invertx,"\n    "),alt:a,title:a,height:"".concat(r,"px"),width:"".concat(r,"px"),onClick:c})};m.defaultProps={invertX:!1};var C=function(t){var e=t.topPosition,a=t.leftPosition,n=t.canUndo,r=t.canRedo,i=t.downloadCallback,c=t.undoCallback,s=t.redoCallback,u=t.resetCallback,l=[{imgUrl:k.a,altText:"Send to Streamlit",invertX:!1,enabled:!0,clickCallback:i},{imgUrl:b.a,altText:"Undo",invertX:!0,enabled:n,clickCallback:n?c:function(){}},{imgUrl:b.a,altText:"Redo",invertX:!1,enabled:r,clickCallback:r?s:function(){}},{imgUrl:v.a,altText:"Reset canvas & history",invertX:!1,enabled:!0,clickCallback:u}];return o.a.createElement("div",{style:{position:"absolute",top:e+4,left:a-24*l.length-8,display:"flex",gap:4,zIndex:20}},l.map((function(t){return o.a.createElement(m,{key:t.altText,imgUrl:t.imgUrl,altText:t.altText,invertX:t.invertX,size:24,enabled:t.enabled,clickCallback:t.clickCallback})})))},g=function(t){var e=Object(n.useState)(new u.fabric.Canvas("")),a=Object(c.a)(e,2),r=a[0],i=a[1],l=function(t,e){var a=Object(n.useState)(t),o=Object(c.a)(a,2),r=o[0],i=o[1];return Object(n.useEffect)((function(){var a=setTimeout((function(){i(t)}),e);return function(){clearTimeout(a)}}),[t,e]),r}(t.stateToSendToStreamlit,200);return Object(n.useEffect)((function(){var t=new u.fabric.Canvas("canvas-to-streamlit",{enableRetinaScaling:!1});i(t)}),[]),Object(n.useEffect)((function(){l&&t.shouldSendToStreamlit&&r.loadFromJSON(l,(function(){!function(t){var e=t.getContext().getImageData(0,0,t.getWidth(),t.getHeight()),a=Array.from(e.data);s.a.setComponentValue({data:a,width:e.width,height:e.height,raw:t.toObject()})}(r)}))}),[r,t.shouldSendToStreamlit,l]),o.a.createElement("canvas",{id:"canvas-to-streamlit",width:t.canvasWidth,height:t.canvasHeight})},w=a(5),y=a(8),O={shouldReloadCanvas:!1,forceSendToStreamlit:!1},j={shouldReloadCanvas:!0,forceSendToStreamlit:!1},p={shouldReloadCanvas:!1,forceSendToStreamlit:!0},M=function(t,e){switch(e.type){case"save":if(e.state){if(Object(l.isEmpty)(t.currentState))return{history:{undoStack:[],redoStack:[]},action:Object(y.a)({},O),initialState:e.state,currentState:e.state};if(Object(l.isEqual)(e.state,t.currentState))return{history:Object(y.a)({},t.history),action:Object(y.a)({},O),initialState:t.initialState,currentState:t.currentState};var a=t.history.undoStack.length>=100;return{history:{undoStack:[].concat(Object(w.a)(t.history.undoStack.slice(a?1:0)),[t.currentState]),redoStack:[]},action:Object(y.a)({},O),initialState:null==t.initialState?t.currentState:t.initialState,currentState:e.state}}throw new Error("No action state to save");case"undo":if(Object(l.isEmpty)(t.currentState)||Object(l.isEqual)(t.initialState,t.currentState))return{history:Object(y.a)({},t.history),action:Object(y.a)({},O),initialState:t.initialState,currentState:t.currentState};var n=0===t.history.undoStack.length;return{history:{undoStack:t.history.undoStack.slice(0,-1),redoStack:[].concat(Object(w.a)(t.history.redoStack),[t.currentState])},action:Object(y.a)({},j),initialState:t.initialState,currentState:n?t.currentState:t.history.undoStack[t.history.undoStack.length-1]};case"redo":return t.history.redoStack.length>0?{history:{undoStack:[].concat(Object(w.a)(t.history.undoStack),[t.currentState]),redoStack:t.history.redoStack.slice(0,-1)},action:Object(y.a)({},j),initialState:t.initialState,currentState:t.history.redoStack[t.history.redoStack.length-1]}:{history:Object(y.a)({},t.history),action:Object(y.a)({},O),initialState:t.initialState,currentState:t.currentState};case"reset":if(!e.state)throw new Error("No action state to store in reset");return{history:{undoStack:[],redoStack:[]},action:Object(y.a)({},j),initialState:e.state,currentState:e.state};case"forceSendToStreamlit":return{history:Object(y.a)({},t.history),action:Object(y.a)({},p),initialState:t.initialState,currentState:t.currentState};default:throw new Error}},E={history:{undoStack:[],redoStack:[]},action:{forceSendToStreamlit:!1,shouldReloadCanvas:!1},initialState:{},currentState:{}},x=Object(n.createContext)({}),R=function(t){var e=t.children,a=Object(n.useReducer)(M,E),r=Object(c.a)(a,2),i=r[0],s=r[1],u=Object(n.useCallback)((function(t){return s({type:"save",state:t})}),[s]),l=Object(n.useCallback)((function(){return s({type:"undo"})}),[s]),h=Object(n.useCallback)((function(){return s({type:"redo"})}),[s]),f=Object(n.useCallback)((function(){return s({type:"forceSendToStreamlit"})}),[s]),d=Object(n.useCallback)((function(t){return s({type:"reset",state:t})}),[s]),v=0!==i.history.undoStack.length,S=0!==i.history.redoStack.length;return o.a.createElement(x.Provider,{value:{canvasState:i,saveState:u,undo:l,redo:h,canUndo:v,canRedo:S,forceStreamlitUpdate:f,resetState:d}},e)},U=a(0),B=a(3),D=a(1),_=a(2),N=function t(e){Object(U.a)(this,t),this._canvas=void 0,this._canvas=e},X={circle:function(t){Object(D.a)(a,t);var e=Object(_.a)(a);function a(){var t;Object(U.a)(this,a);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))).isMouseDown=!1,t.fillColor="#ffffff",t.strokeWidth=10,t.strokeColor="#ffffff",t.currentCircle=new u.fabric.Circle,t.currentStartX=0,t.currentStartY=0,t.linearDistance=function(t,e){var a=e.x-t.x,n=e.y-t.y;return Math.sqrt(a*a+n*n)},t}return Object(B.a)(a,[{key:"configureCanvas",value:function(t){var e=this,a=t.strokeWidth,n=t.strokeColor,o=t.fillColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=a,this.strokeColor=n,this.fillColor=o,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas;this.isMouseDown=!0;var a=e.getPointer(t.e);this.currentStartX=a.x,this.currentStartY=a.y,this.currentCircle=new u.fabric.Circle({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.fillColor,selectable:!1,evented:!1,radius:1}),e.add(this.currentCircle)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,a=e.getPointer(t.e);this.currentCircle.set({radius:this.linearDistance({x:this.currentStartX,y:this.currentStartY},{x:a.x,y:a.y})/2,angle:180*Math.atan2(a.y-this.currentStartY,a.x-this.currentStartX)/Math.PI}),this.currentCircle.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),a}(N),freedraw:function(t){Object(D.a)(a,t);var e=Object(_.a)(a);function a(){return Object(U.a)(this,a),e.apply(this,arguments)}return Object(B.a)(a,[{key:"configureCanvas",value:function(t){var e=t.strokeWidth,a=t.strokeColor;return this._canvas.isDrawingMode=!0,this._canvas.freeDrawingBrush.width=e,this._canvas.freeDrawingBrush.color=a,function(){}}}]),a}(N),line:function(t){Object(D.a)(a,t);var e=Object(_.a)(a);function a(){var t;Object(U.a)(this,a);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))).isMouseDown=!1,t.strokeWidth=10,t.strokeColor="#ffffff",t.currentLine=new u.fabric.Line,t}return Object(B.a)(a,[{key:"configureCanvas",value:function(t){var e=this,a=t.strokeWidth,n=t.strokeColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=a,this.strokeColor=n,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas;this.isMouseDown=!0;var a=e.getPointer(t.e),n=[a.x,a.y,a.x,a.y];this.currentLine=new u.fabric.Line(n,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),e.add(this.currentLine)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,a=e.getPointer(t.e);this.currentLine.set({x2:a.x,y2:a.y}),this.currentLine.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),a}(N),rect:function(t){Object(D.a)(a,t);var e=Object(_.a)(a);function a(){var t;Object(U.a)(this,a);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(t=e.call.apply(e,[this].concat(o))).isMouseDown=!1,t.fillColor="#ffffff",t.strokeWidth=10,t.strokeColor="#ffffff",t.currentRect=new u.fabric.Rect,t.currentStartX=0,t.currentStartY=0,t}return Object(B.a)(a,[{key:"configureCanvas",value:function(t){var e=this,a=t.strokeWidth,n=t.strokeColor,o=t.fillColor;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject((function(t){return t.selectable=t.evented=!1})),this.strokeWidth=a,this.strokeColor=n,this.fillColor=o,this._canvas.on("mouse:down",(function(t){return e.onMouseDown(t)})),this._canvas.on("mouse:move",(function(t){return e.onMouseMove(t)})),this._canvas.on("mouse:up",(function(t){return e.onMouseUp(t)})),this._canvas.on("mouse:out",(function(t){return e.onMouseOut(t)})),function(){e._canvas.off("mouse:down"),e._canvas.off("mouse:move"),e._canvas.off("mouse:up"),e._canvas.off("mouse:out")}}},{key:"onMouseDown",value:function(t){var e=this._canvas;this.isMouseDown=!0;var a=e.getPointer(t.e);this.currentStartX=a.x,this.currentStartY=a.y,this.currentRect=new u.fabric.Rect({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"top",width:a.x-this.currentStartX,height:a.y-this.currentStartY,stroke:this.strokeColor,strokeWidth:this.strokeWidth,fill:this.fillColor,transparentCorners:!1,selectable:!1,evented:!1,strokeUniform:!0,noScaleCache:!1,angle:0}),e.add(this.currentRect)}},{key:"onMouseMove",value:function(t){if(this.isMouseDown){var e=this._canvas,a=e.getPointer(t.e);this.currentStartX>a.x&&this.currentRect.set({left:Math.abs(a.x)}),this.currentStartY>a.y&&this.currentRect.set({top:Math.abs(a.y)}),this.currentRect.set({width:Math.abs(this.currentStartX-a.x)}),this.currentRect.set({height:Math.abs(this.currentStartY-a.y)}),this.currentRect.setCoords(),e.renderAll()}}},{key:"onMouseUp",value:function(t){this.isMouseDown=!1}},{key:"onMouseOut",value:function(t){this.isMouseDown=!1}}]),a}(N),transform:function(t){Object(D.a)(a,t);var e=Object(_.a)(a);function a(){return Object(U.a)(this,a),e.apply(this,arguments)}return Object(B.a)(a,[{key:"configureCanvas",value:function(t){var e=this._canvas;e.isDrawingMode=!1,e.selection=!0,e.forEachObject((function(t){return t.selectable=t.evented=!0}));var a=function(){e.remove(e.getActiveObject())};return e.on("mouse:dblclick",a),function(){e.off("mouse:dblclick",a)}}}]),a}(N)},Y=Object(s.b)((function(t){var e=t.args,a=e.canvasWidth,r=e.canvasHeight,i=e.backgroundColor,h=e.backgroundImage,f=e.realtimeUpdateStreamlit,d=e.drawingMode,v=e.fillColor,S=e.strokeWidth,b=e.strokeColor,A=e.initialDrawing,k=Object(n.useState)(new u.fabric.Canvas("")),m=Object(c.a)(k,2),w=m[0],y=m[1],O=Object(n.useState)(new u.fabric.StaticCanvas("")),j=Object(c.a)(O,2),p=j[0],M=j[1],E=Object(n.useContext)(x),R=E.canvasState,U=R.action,B=U.shouldReloadCanvas,D=U.forceSendToStreamlit,_=R.currentState,N=R.initialState,Y=E.saveState,T=E.undo,I=E.redo,V=E.canUndo,H=E.canRedo,W=E.forceStreamlitUpdate,L=E.resetState;return Object(n.useEffect)((function(){var t=new u.fabric.Canvas("canvas",{enableRetinaScaling:!1}),e=new u.fabric.StaticCanvas("backgroundimage-canvas",{enableRetinaScaling:!1});y(t),M(e),s.a.setFrameHeight()}),[]),Object(n.useEffect)((function(){Object(l.isEqual)(N,A)||w.loadFromJSON(A,(function(){w.renderAll(),L(A)}))}),[w,A,N,L]),Object(n.useEffect)((function(){B&&w.loadFromJSON(_,(function(){}))}),[w,B,_]),Object(n.useEffect)((function(){w.setBackgroundColor(i,(function(){w.renderAll(),Y(w.toJSON())}))}),[w,i,Y]),Object(n.useEffect)((function(){if(h){var t=p.getContext().createImageData(a,r);t.data.set(h),p.getContext().putImageData(t,0,0)}}),[p,r,a,h]),Object(n.useEffect)((function(){var t=new X[d](w).configureCanvas({fillColor:v,strokeWidth:S,strokeColor:b});return w.on("mouse:up",(function(){Y(w.toJSON())})),w.on("mouse:dblclick",(function(){Y(w.toJSON())})),function(){t(),w.off("mouse:up"),w.off("mouse:dblclick")}}),[w,S,b,v,d,A,Y]),o.a.createElement("div",{style:{position:"relative"}},o.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:-10,visibility:"hidden"}},o.a.createElement(g,{canvasHeight:r,canvasWidth:a,shouldSendToStreamlit:f||D,stateToSendToStreamlit:_})),o.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:0}},o.a.createElement("canvas",{id:"backgroundimage-canvas",width:a,height:r})),o.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:10}},o.a.createElement("canvas",{id:"canvas",width:a,height:r,style:{border:"lightgrey 1px solid"}})),o.a.createElement(C,{topPosition:r,leftPosition:a,canUndo:V,canRedo:H,downloadCallback:W,undoCallback:T,redoCallback:I,resetCallback:function(){w.clear(),w.setBackgroundColor(i,(function(){L(w.toJSON())}))}}))}));a(44);i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(R,null,o.a.createElement(Y,null))),document.getElementById("root"))}},[[28,1,2]]]);
//# sourceMappingURL=main.2e422ea4.chunk.js.map