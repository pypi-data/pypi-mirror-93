(self.webpackChunkipannotoryous=self.webpackChunkipannotoryous||[]).push([[841],{657:(e,t,n)=>{"use strict";n.d(t,{Y:()=>i,o:()=>a});const o=n(306),i=o.version,a=o.name},841:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AnnotoriusModel:()=>l,AnnotoriusView:()=>d,AuthorModel:()=>r});var o=n(246),i=n(560);n(204);var a=n(657);const s=["jp-OutputArea-output","jp-OutputArea-child","jp-Cell-outputArea"];class r extends o.WidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:r.model_name,_model_module:r.model_module,_model_module_version:r.model_module_version,id:"",displayName:""})}}r.model_name="AuthorModel",r.model_module=a.o,r.model_module_version=a.Y,r.view_name=null,r.view_module=null,r.view_module_version=a.Y;class l extends o.DOMWidgetModel{constructor(){super(...arguments),this._annotations=[]}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:l.model_name,_model_module:l.model_module,_model_module_version:l.model_module_version,_view_name:l.view_name,_view_module:l.view_module,_view_module_version:l.view_module_version,format:"png",width:"",height:"",value:new DataView(new ArrayBuffer(0)),author:null,default_tags:[],drawingTool:"rect",headless:!1,readOnly:!1,template:[]})}get annotations(){return this._annotations}initialize(e,t){super.initialize(e,t),this.on("msg:custom",this.onCustomMsg,this),this.send({event:"onModelIsReady"},{})}onCustomMsg(e,t){const n=e.action,o=this._annotations.findIndex((t=>{var n;return t.id===((null===(n=e.annotation)||void 0===n?void 0:n.id)?e.annotation.id:e.annotation)}));switch(n){case"delete":if(o>=0){const e=this._annotations.splice(o,1);this._forEachView((t=>{t.deleteAnnotation(e[0])}))}break;case"image_snippet":(t=>{const n=Object.keys(t);n.length>0&&t[n[0]].then((e=>{var t;if(o>=0){const n=null===(t=e.selectedAnnotation)||void 0===t?void 0:t.id;this._annotations[o]!==n&&e.selectAnnotation(this._annotations[o])}const n=e.selectedImageSnippet;return n?async function(e){const t=await async function(e){return new Promise(((t,n)=>{e.toBlob((e=>{if(null==e)return n("Unable to create blob");t(e)}))}))}(e);return new Promise(((e,n)=>{const o=new FileReader;o.onloadend=()=>{if("string"==typeof o.result||null==o.result)return n("Unable to read blob");const t=new Uint8ClampedArray(o.result);e(t)},o.readAsArrayBuffer(t)}))}(n.snippet):Promise.resolve(null)})).then((t=>{this.send({event:"imageSnippet",uid:e.uid},{},t?[t.buffer]:void 0)})).catch((e=>{console.error("Fail to get selected image snippet.",e)}))})(this.views);break;case"update":o>=0?this._annotations[o]=Object.assign({},e.annotation):this._annotations.push(e.annotation),this._forEachView((t=>{t.updateAnnotation(e.annotation)}))}}_forEachView(e){const t=this.views;for(const n in t)t[n].then((t=>{e(t)}))}}l.serializers=Object.assign(Object.assign({},o.DOMWidgetModel.serializers),{value:{serialize:e=>new DataView(e.buffer.slice(0))},author:{deserialize:o.unpack_models}}),l.model_name="AnnotoriusModel",l.model_module=a.o,l.model_module_version=a.Y,l.view_name="AnnotoriusView",l.view_module=a.o,l.view_module_version=a.Y;class d extends o.DOMWidgetView{get selectedAnnotation(){var e;return null===(e=this._annotator)||void 0===e?void 0:e.getSelected()}get selectedImageSnippet(){var e;return null===(e=this._annotator)||void 0===e?void 0:e.getSelectedImageSnippet()}render(){this.pWidget.addClass("annotorius-widget"),this._img=document.createElement("img"),this.el.append(this._img),this._annotator=(0,i.init)({image:this._img,locale:"auto",readOnly:this.model.get("readOnly"),headless:this.model.get("headless"),formatter:d._formatAnnotation,widgets:["COMMENT",{widget:"TAG",vocabulary:this.model.get("default_tags")}]}),this.displayed.then((()=>{this._updateParentOverflowStyle("visible")})),this.model.on({"change:value":this.valueChanged,"change:format":this.valueChanged,"change:height":this.valueChanged,"change:width":this.valueChanged,"change:author":this.authorChanged,"change:drawingTool":this.drawingToolChanged},this),this._annotator.on("createAnnotation",this.handleCreate.bind(this)),this._annotator.on("deleteAnnotation",this.handleDelete.bind(this)),this._annotator.on("selectAnnotation",this.handleSelect.bind(this)),this._annotator.on("updateAnnotation",this.handleUpdate.bind(this)),this._annotator.on("createSelection",this.handleCreateSelection.bind(this)),this.valueChanged(),this.authorChanged(),this.drawingToolChanged(),this.model.annotations.forEach((e=>{this.updateAnnotation(e)}))}remove(){this._updateParentOverflowStyle(),this._annotator&&(this._annotator.off("createAnnotation",this.handleCreate.bind(this)),this._annotator.off("deleteAnnotation",this.handleDelete.bind(this)),this._annotator.off("selectAnnotation",this.handleSelect.bind(this)),this._annotator.off("updateAnnotation",this.handleUpdate.bind(this)),this._annotator.off("createSelection",this.handleCreateSelection.bind(this)),this._annotator.destroy()),this.model.off(void 0,void 0,this),this._img.src&&URL.revokeObjectURL(this._img.src),super.remove()}selectAnnotation(e){var t;null===(t=this._annotator)||void 0===t||t.selectAnnotation(e)}updateAnnotation(e){this._annotator.addAnnotation(e)}deleteAnnotation(e){this._annotator.removeAnnotation(e)}handleCreate(e){this.send({event:"onCreateAnnotation",args:{annotation:e}})}handleCreateSelection(e){var t;const n=this.model.get("template");n.length>0&&(e.body=n,null===(t=this._annotator)||void 0===t||t.updateSelected(e,!0))}handleDelete(e){this.send({event:"onDeleteAnnotation",args:{annotation:e}})}handleSelect(e){this.send({event:"onSelectAnnotation",args:{annotation:e}})}handleUpdate(e,t){this.send({event:"onUpdateAnnotation",args:{annotation:e,previous:t}})}authorChanged(){var e,t;const n=this.model.get("author");n?null===(e=this._annotator)||void 0===e||e.setAuthInfo({id:n.get("id"),displayName:n.get("displayName")}):null===(t=this._annotator)||void 0===t||t.clearAuthInfo()}drawingToolChanged(){var e;null===(e=this._annotator)||void 0===e||e.setDrawingTool(this.model.get("drawingTool"))}valueChanged(){let e;const t=this.model.get("format"),n=this.model.get("value");if("url"!==t){const t=new Blob([n],{type:`image/${this.model.get("format")}`});e=URL.createObjectURL(t)}else e=new TextDecoder("utf-8").decode(n.buffer);const o=this._img.src;this._img.src=e,o&&"string"!=typeof o&&URL.revokeObjectURL(o);const i=this.model.get("height");void 0!==i&&i.length>0?this._img.setAttribute("height",i):this._img.removeAttribute("height");const a=this.model.get("width");void 0!==a&&a.length>0?this._img.setAttribute("width",a):this._img.removeAttribute("width")}static _formatAnnotation(e){const t=e.body.filter((e=>"tagging"===e.purpose)).map((e=>e.value));if(t.length>0)return{"data-tags":t.join(",")}}_updateParentOverflowStyle(e=""){let t=this.el;s.forEach((n=>{for(;t;)if(t=t.parentElement,null==t?void 0:t.classList.contains(n)){t.style.overflow=e;break}}))}}},889:(e,t,n)=>{var o=n(645),i=n(16);(t=o(!1)).i(i),t.push([e.id,".lm-Widget.annotorius-widget {\n  overflow: visible;\n}\n\n.annotorius-widget svg.a9s-annotationlayer {\n  overflow: visible;\n}\n",""]),e.exports=t},204:(e,t,n)=>{var o=n(379),i=n(889);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.id,i,""]]);o(i,{insert:"head",singleton:!1}),e.exports=i.locals||{}},306:e=>{"use strict";e.exports=JSON.parse('{"name":"ipannotoryous","version":"1.0.0","description":"A annotation Jupyter Widget based on Annotorius.","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","dist/*.js","css/*.css"],"homepage":"https://github.com/fcollonval/ipannotoryous","bugs":{"url":"https://github.com/fcollonval/ipannotoryous/issues"},"license":"BSD-3-Clause","author":{"name":"ARIADNEXT","email":"fcollonval@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/fcollonval/ipannotoryous"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension:dev","build:lib":"tsc","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:nbextension":"webpack -p","build:all":"yarn run build:lib && yarn run build:labextension && yarn run build:nbextension","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:labextension":"rimraf ipannotoryous/labextension","clean:nbextension":"rimraf ipannotoryous/nbextension/static/index.js","lint":"eslint . --ext .ts,.tsx --fix","lint:check":"eslint . --ext .ts,.tsx","prepack":"yarn run build:lib","test":"yarn run test:ci","test:ci":"karma start --browsers=ChromeCI tests/karma.conf.js","test:chrome":"karma start --browsers=Chrome tests/karma.conf.js","test:debug":"karma start --browsers=Chrome --singleRun=false --debug=true tests/karma.conf.js","test:firefox":"karma start --browsers=Firefox tests/karma.conf.js","watch":"npm-run-all -p watch:*","watch:lib":"tsc -w","watch:nbextension":"webpack --watch","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^1.1.10 || ^2.0.1 || ^3.0.0 || ^4.0.0","@recogito/annotorious":"^2.2.0"},"devDependencies":{"@jupyterlab/builder":"^3.0.0","@lumino/application":"^1.6.0","@lumino/widgets":"^1.6.0","@types/expect.js":"^0.3.29","@types/mocha":"^8.2.0","@types/node":"^14.14.13","@types/webpack-env":"^1.13.6","@typescript-eslint/eslint-plugin":"^3.6.0","@typescript-eslint/parser":"^3.6.0","acorn":"^7.2.0","css-loader":"^3.2.0","eslint":"^7.4.0","eslint-config-prettier":"^6.11.0","eslint-plugin-prettier":"^3.1.4","expect.js":"^0.3.1","fs-extra":"^7.0.0","karma":"^5.2.3","karma-chrome-launcher":"^3.1.0","karma-coverage":"^2.0.1","karma-firefox-launcher":"^2.1.0","karma-mocha":"^2.0.1","karma-mocha-reporter":"^2.2.5","karma-typescript":"^5.2.0","karma-typescript-es6-transform":"^5.2.0","mkdirp":"^0.5.1","mocha":"^8.2.1","npm-run-all":"^4.1.3","prettier":"^2.0.5","rimraf":"^2.6.2","source-map-loader":"^1.1.3","style-loader":"^1.0.0","ts-loader":"^8.0.12","typescript":"~3.8","webpack":"^4.20.2","webpack-cli":"^3.1.2"},"jupyterlab":{"extension":"lib/plugin","outputDir":"ipannotoryous/labextension","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);