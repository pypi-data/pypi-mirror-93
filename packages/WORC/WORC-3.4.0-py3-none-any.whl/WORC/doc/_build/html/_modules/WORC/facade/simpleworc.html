

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>WORC.facade.simpleworc &mdash; WORC 3.3.5 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> WORC
          

          
            
            <img src="../../../_static/WORC_Logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.3.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../static/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/quick_start.html">Quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/user_manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/features.html">Radiomics Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/additionalfunctionality.html">Additional functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/developerdocumentation.html">Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/file_description.html">Resource File Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../static/changelog.html">Changelog</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../autogen/WORC.html">WORC Package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">WORC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>WORC.facade.simpleworc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for WORC.facade.simpleworc</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># Copyright 2016-2020 Biomedical Imaging Group Rotterdam, Departments of</span>
<span class="c1"># Medical Informatics and Radiology, Erasmus MC, Rotterdam, The Netherlands</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">import</span> <span class="nn">fastr.exceptions</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">WORC</span> <span class="k">import</span> <span class="n">WORC</span>
<span class="kn">from</span> <span class="nn">.helpers.processing</span> <span class="k">import</span> <span class="n">convert_radiomix_features</span>
<span class="kn">from</span> <span class="nn">.helpers.exceptions</span> <span class="k">import</span> <span class="n">PathNotFoundException</span><span class="p">,</span> <span class="n">NoImagesFoundException</span><span class="p">,</span> \
    <span class="n">NoSegmentationsFoundException</span><span class="p">,</span> <span class="n">InvalidCsvFileException</span><span class="p">,</span> \
    <span class="n">NoFeaturesFoundException</span>
<span class="kn">from</span> <span class="nn">WORC.addexceptions</span> <span class="k">import</span> <span class="n">WORCKeyError</span><span class="p">,</span> <span class="n">WORCValueError</span><span class="p">,</span> <span class="n">WORCAssertionError</span>
<span class="kn">from</span> <span class="nn">.helpers.configbuilder</span> <span class="k">import</span> <span class="n">ConfigBuilder</span>
<span class="kn">from</span> <span class="nn">WORC.detectors.detectors</span> <span class="k">import</span> <span class="n">CsvDetector</span><span class="p">,</span> <span class="n">BigrClusterDetector</span><span class="p">,</span> \
    <span class="n">CartesiusClusterDetector</span>

<span class="kn">from</span> <span class="nn">WORC.validators.preflightcheck</span> <span class="k">import</span> <span class="n">ValidatorsFactory</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>


<span class="k">def</span> <span class="nf">_for_all_methods</span><span class="p">(</span><span class="n">decorator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Methods to attach an object to all methods.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>  <span class="c1"># there&#39;s propably a better way to do this</span>
            <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">)):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">decorator</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">attr</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">return</span> <span class="n">decorate</span>


<span class="k">def</span> <span class="nf">_error_bulldozer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether raised errors are known or should never occur.&quot;&quot;&quot;</span>
    <span class="n">_valid_exceptions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PathNotFoundException</span><span class="p">,</span> <span class="n">NoImagesFoundException</span><span class="p">,</span>
        <span class="n">NoSegmentationsFoundException</span><span class="p">,</span> <span class="n">InvalidCsvFileException</span><span class="p">,</span>
        <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="n">WORCKeyError</span><span class="p">,</span>
        <span class="n">WORCValueError</span><span class="p">,</span> <span class="n">WORCAssertionError</span>
    <span class="p">]</span>
    <span class="n">_valid_exceptions</span> <span class="o">+=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">fastr</span><span class="o">.</span><span class="n">exceptions</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">)]</span>

    <span class="n">unexpected_exception_exception</span> <span class="o">=</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;A blackhole to another dimenstion has opened. This exception should never be thrown. Double check your code or make an issue on the WORC github so that we can fix this issue.&#39;</span><span class="p">)</span>

    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dec</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_valid_exceptions</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">unexpected_exception_exception</span>
            <span class="k">raise</span> <span class="n">e</span>
    <span class="k">return</span> <span class="n">dec</span>


<div class="viewcode-block" id="SimpleWORC"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC">[docs]</a><span class="nd">@_for_all_methods</span><span class="p">(</span><span class="n">_error_bulldozer</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SimpleWORC</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Facade around the main WORC object for simple interaction.</span>

<span class="sd">    Please also see the `WORCTutorial Github &lt;https://github.com/MStarmans91/WORCTutorial/&gt;`_.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SimpleWORC.__init__"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;WORC&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize SimpleWORC object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        name: string, default WORC</span>
<span class="sd">            String to identify name of experiments. Will be used in the temporary files and outputs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set some config values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span> <span class="o">=</span> <span class="n">WORC</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_images_train</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_images_test</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_features_train</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_features_test</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_train</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_test</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_train</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_test</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radiomix_feature_file</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_train</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_test</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span> <span class="o">=</span> <span class="n">ConfigBuilder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_evaluation</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Detect wether we are on a cluster</span>
        <span class="k">if</span> <span class="n">BigrClusterDetector</span><span class="p">()</span><span class="o">.</span><span class="n">do_detection</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">fastr_plugin</span> <span class="o">=</span> <span class="s1">&#39;DRMAAExecution&#39;</span>
        <span class="k">elif</span> <span class="n">CartesiusClusterDetector</span><span class="p">()</span><span class="o">.</span><span class="n">do_detection</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">fastr_plugin</span> <span class="o">=</span> <span class="s1">&#39;ProcessPoolExecution&#39;</span></div>

<div class="viewcode-block" id="SimpleWORC.features_from_this_directory"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.features_from_this_directory">[docs]</a>    <span class="k">def</span> <span class="nf">features_from_this_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span>
                                     <span class="n">feature_file_name</span><span class="o">=</span><span class="s1">&#39;features.hdf5&#39;</span><span class="p">,</span>
                                     <span class="n">glob</span><span class="o">=</span><span class="s1">&#39;*/&#39;</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use features from a directory as sources in WORC.</span>

<span class="sd">        SimpleWORC uses a directory glob to look for files meeting</span>
<span class="sd">        the requirements to include, based on the input parameters.</span>

<span class="sd">        Example:</span>
<span class="sd">        When using &quot;directory = C:\\Users\\MyName\\FeatureFolder&quot;,</span>
<span class="sd">        features_from_this_directory will include all features.hdf5 files from all subfolders in the directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: string</span>
<span class="sd">            Identifies the root directory in which to search for feature files.</span>
<span class="sd">        feature_file_name: string, default features.hdf5</span>
<span class="sd">            Name of the files which will be included. Can include wildcards (*).</span>
<span class="sd">        glob: string, default */</span>
<span class="sd">            Identify the search string to be used in the glob. Can include wildcards (*).</span>
<span class="sd">        is_training: Boolean, default True</span>
<span class="sd">            Identify whether these features should be used in the training or test dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PathNotFoundException</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">directory</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{glob}{feature_file_name}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoFeaturesFoundException</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{directory}{glob}{image_file_name}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">features_per_subject</span> <span class="o">=</span> <span class="p">{</span><span class="n">feature</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">feature</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">is_training</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_features_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features_per_subject</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_features_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features_per_subject</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.images_from_this_directory"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.images_from_this_directory">[docs]</a>    <span class="k">def</span> <span class="nf">images_from_this_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">image_file_name</span><span class="o">=</span><span class="s1">&#39;image.nii.gz&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="s1">&#39;*/&#39;</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use images from a directory as sources in WORC.</span>

<span class="sd">        SimpleWORC uses a directory glob to look for files meeting</span>
<span class="sd">        the requirements to include, based on the input parameters.</span>

<span class="sd">        Example:</span>
<span class="sd">        When using &quot;directory = C:\\Users\\MyName\\ImageFolder&quot;,</span>
<span class="sd">        images_from_this_directory will include all image.nii.gz files from all subfolders in the directory.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory: string</span>
<span class="sd">            Identifies the root directory in which to search for image files.</span>
<span class="sd">        image_file_name: string, default image.nii.gz</span>
<span class="sd">            Name of the files which will be included. Can include wildcards (*).</span>
<span class="sd">        glob: string, default */</span>
<span class="sd">            Identify the search string to be used in the glob. Can include wildcards (*).</span>
<span class="sd">        is_training: Boolean, default True</span>
<span class="sd">            Identify whether these images should be used in the training or test dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PathNotFoundException</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="n">images</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">directory</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{glob}{image_file_name}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoImagesFoundException</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{directory}{glob}{image_file_name}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">images_per_subject</span> <span class="o">=</span> <span class="p">{</span><span class="n">image</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">images</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">is_training</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_images_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images_per_subject</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_images_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">images_per_subject</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.segmentations_from_this_directory"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.segmentations_from_this_directory">[docs]</a>    <span class="k">def</span> <span class="nf">segmentations_from_this_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">segmentation_file_name</span><span class="o">=</span><span class="s1">&#39;segmentation.nii.gz&#39;</span><span class="p">,</span> <span class="n">glob</span><span class="o">=</span><span class="s1">&#39;*/&#39;</span><span class="p">,</span>
                                          <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use segmentations from a directory as sources in WORC.</span>

<span class="sd">         SimpleWORC uses a directory glob to look for files meeting</span>
<span class="sd">         the requirements to include, based on the input parameters.</span>

<span class="sd">         Example:</span>
<span class="sd">         When using &quot;directory = C:\\Users\\MyName\\SegmentationFolder&quot;,</span>
<span class="sd">         segmentations_from_this_directory will include all segmentation.nii.gz files from all subfolders in the directory.</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">         directory: string</span>
<span class="sd">             Identifies the root directory in which to search for segmentation files.</span>
<span class="sd">         segmentation_file_name: string, default segmentation.nii.gz</span>
<span class="sd">             Name of the files which will be included. Can include wildcards (*).</span>
<span class="sd">         glob: string, default */</span>
<span class="sd">             Identify the search string to be used in the glob. Can include wildcards (*).</span>
<span class="sd">         is_training: Boolean, default True</span>
<span class="sd">             Identify whether these segmentations should be used in the training or test dataset.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">directory</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PathNotFoundException</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="n">segmentations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">directory</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{glob}{segmentation_file_name}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segmentations</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoSegmentationsFoundException</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">directory</span><span class="p">))</span>

        <span class="n">segmentations_per_subject</span> <span class="o">=</span> <span class="p">{</span><span class="n">segmentation</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">segmentation</span> <span class="ow">in</span> <span class="n">segmentations</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">is_training</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations_per_subject</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segmentations_per_subject</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.labels_from_this_file"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.labels_from_this_file">[docs]</a>    <span class="k">def</span> <span class="nf">labels_from_this_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define which file should be used by WORC to extract the object labels.</span>

<span class="sd">        Should be a .csv or .txt file: see</span>
<span class="sd">        :ref:`the WORC user manual &lt;usermanual-chapter:&gt;` for more details on</span>
<span class="sd">        the formatting of this file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path: basestring</span>
<span class="sd">            Location of the file to be used as label file. Can be a .csv or .txt file.</span>
<span class="sd">        is_training: Boolean, default True</span>
<span class="sd">            Identify whether this label file should be used in the training or test dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">labels_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PathNotFoundException</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">CsvDetector</span><span class="p">(</span><span class="n">labels_file</span><span class="o">.</span><span class="n">absolute</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">InvalidCsvFileException</span><span class="p">(</span><span class="n">labels_file</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">is_training</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_train</span> <span class="o">=</span> <span class="n">labels_file</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_test</span> <span class="o">=</span> <span class="n">labels_file</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.semantics_from_this_file"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.semantics_from_this_file">[docs]</a>    <span class="k">def</span> <span class="nf">semantics_from_this_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">is_training</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define which file should be used by WORC to extract the semantic features.</span>

<span class="sd">        The values in these file can be used as semantic, i.e. non-computational,</span>
<span class="sd">        features in WORC. Should be a .csv file: see</span>
<span class="sd">        :ref:`the WORC user manual &lt;usermanual-chapter:&gt;` for more details on</span>
<span class="sd">        the formatting of this file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_path: basestring</span>
<span class="sd">            Location of the file to be used as semantics file. Can be a .csv or .txt file.</span>
<span class="sd">        is_training: Boolean, default True</span>
<span class="sd">            Identify whether this semantics  file should be used in the training or test dataset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">semantics_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">semantics_file</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">PathNotFoundException</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">CsvDetector</span><span class="p">(</span><span class="n">semantics_file</span><span class="o">.</span><span class="n">absolute</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">InvalidCsvFileException</span><span class="p">(</span><span class="n">semantics_file</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>

        <span class="c1"># TODO: implement sanity check semantics file e.g. is it a semantics file and are there semantics available</span>
        <span class="k">if</span> <span class="n">is_training</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_train</span> <span class="o">=</span> <span class="p">[</span><span class="n">semantics_file</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">semantics_file</span><span class="o">.</span><span class="n">as_uri</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%20&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)]</span></div>

<div class="viewcode-block" id="SimpleWORC.predict_labels"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.predict_labels">[docs]</a>    <span class="k">def</span> <span class="nf">predict_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine which label(s) to predict in your experiments.</span>

<span class="sd">        The labels(s) you want to predict should be given in strings and</span>
<span class="sd">        should be included in the header of your labels_from_this_file csv.</span>
<span class="sd">        Note that you therefore first need to use that function to determine</span>
<span class="sd">        which label file to use, and afterwards use this function</span>
<span class="sd">        to select one of the headers / columns containing the actual label.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        label_names: list</span>
<span class="sd">            List of strings containing the label name(s) to predict. For each</span>
<span class="sd">            label, a separate (classification) model will be created, or,</span>
<span class="sd">            if a multilabel experiment is run, a singel multiclass / multilabel</span>
<span class="sd">            classification model</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_train</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_file_train</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;No labels file set! You can do this through labels_from_this_file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;label_names is of type {type(label_names)} while list is expected&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid label, length = 0&#39;</span><span class="p">)</span>

        <span class="c1"># TODO: check if labels is in labels file</span>

        <span class="c1"># self._worc.label_names = &#39;, &#39;.join(label_names)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label_names</span> <span class="o">=</span> <span class="n">label_names</span></div>

    <span class="k">def</span> <span class="nf">_set_and_validate_estimators</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimators</span><span class="p">,</span> <span class="n">scoring_method</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">coarse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether the given estimators in the config are valid for the experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        estimators: list</span>
<span class="sd">            String(s) of the estimators to be used. See the</span>
<span class="sd">            :ref:`WORC Config chapter &lt;config-chapter&gt;` for allowed options.</span>
<span class="sd">        scoring_method: string</span>
<span class="sd">            Name of metric to be used for ranking the workflows.</span>
<span class="sd">        method: string</span>
<span class="sd">            Currently supported: classification or regression</span>
<span class="sd">        coarse: boolean</span>
<span class="sd">            Determine whether to do a coarse or full experiment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># validate</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;classification&#39;</span><span class="p">:</span>
            <span class="n">valid_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;RF&#39;</span><span class="p">,</span> <span class="s1">&#39;SGD&#39;</span><span class="p">,</span> <span class="s1">&#39;LR&#39;</span><span class="p">,</span> <span class="s1">&#39;GaussianNB&#39;</span><span class="p">,</span> <span class="s1">&#39;ComplementNB&#39;</span><span class="p">,</span> <span class="s1">&#39;LDA&#39;</span><span class="p">,</span> <span class="s1">&#39;QDA&#39;</span><span class="p">,</span> <span class="s1">&#39;RankedSVM&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;regression&#39;</span><span class="p">:</span>
            <span class="n">valid_estimators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVR&#39;</span><span class="p">,</span> <span class="s1">&#39;RFR&#39;</span><span class="p">,</span> <span class="s1">&#39;ElasticNet&#39;</span><span class="p">,</span> <span class="s1">&#39;Lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;SGDR&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">valid_estimators</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">estimator</span> <span class="ow">in</span> <span class="n">estimators</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">estimator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_estimators</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="n">f</span><span class="s1">&#39;Invalid estimator </span><span class="si">{estimator}</span><span class="s1"> for </span><span class="si">{method}</span><span class="s1">; must be one of {&quot;, &quot;.join(valid_estimators)}&#39;</span><span class="p">)</span>

        <span class="c1"># TODO: sanity check scoring method per estimator</span>

        <span class="c1"># set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span><span class="o">.</span><span class="n">estimator_scoring_overrides</span><span class="p">(</span><span class="n">estimators</span><span class="p">,</span> <span class="n">scoring_method</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">coarse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span><span class="o">.</span><span class="n">coarse_overrides</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_method</span> <span class="o">=</span> <span class="n">method</span>

<div class="viewcode-block" id="SimpleWORC.count_num_subjects"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.count_num_subjects">[docs]</a>    <span class="k">def</span> <span class="nf">count_num_subjects</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Count the number of subjects in the experiment.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radiomix_feature_file</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_radiomix_feature_file</span><span class="p">)</span>
            <span class="n">pids</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>
            <span class="n">tocount</span> <span class="o">=</span> <span class="n">pids</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_train</span><span class="p">:</span>
            <span class="n">tocount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features_train</span><span class="p">:</span>
            <span class="n">tocount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_train</span><span class="p">:</span>
            <span class="n">tocount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_train</span><span class="p">:</span>
            <span class="n">tocount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_train</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;No features or images given, cannot count number &#39;</span> <span class="o">+</span>\
                <span class="s1">&#39; of subjects. Make sure you input at least one of these &#39;</span> <span class="o">+</span>\
                <span class="s1">&#39;as source.&#39;</span>
            <span class="k">raise</span> <span class="n">WORCValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tocount</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">():</span>
            <span class="n">num_subjects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tocount</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_subjects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tocount</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_subjects</span> <span class="o">=</span> <span class="n">num_subjects</span></div>

    <span class="k">def</span> <span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Run various validators to validate the experiment.&quot;&quot;&quot;</span>
        <span class="n">validators</span> <span class="o">=</span> <span class="n">ValidatorsFactory</span><span class="o">.</span><span class="n">factor_validators</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count_num_subjects</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">validator</span> <span class="ow">in</span> <span class="n">validators</span><span class="p">:</span>
            <span class="n">validator</span><span class="o">.</span><span class="n">do_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="SimpleWORC.execute"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Execute the experiment.</span>

<span class="sd">        Before executing the actual experiment, this function will first run several validators</span>
<span class="sd">        and check the provided setup to make sure some of the most common</span>
<span class="sd">        made error are caught before running the experiment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do some final sanity checking before we execute the experiment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_radiomix_feature_file</span><span class="p">:</span>
            <span class="c1"># Convert radiomix features and use those as inputs</span>
            <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fastr</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">mounts</span><span class="p">[</span><span class="s1">&#39;tmp&#39;</span><span class="p">],</span>
                                         <span class="s1">&#39;Radiomix_features&#39;</span><span class="p">)</span>

            <span class="c1"># Check if output folder exists: otherwise create</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_folder</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>

            <span class="c1"># convert the features</span>
            <span class="n">convert_radiomix_features</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_radiomix_feature_file</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">)</span>

            <span class="c1"># Set the newly created feature files as the WORC input</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">features_from_this_directory</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>

        <span class="c1"># Give set sources to the WORC object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">images_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">features_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">segmentations_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">labels_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_train</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">semantics_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_train</span>

        <span class="c1"># If a specific train-test setup is provided, add test sources</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">images_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_images_test</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">features_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_features_test</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">segmentations_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentations_test</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">labels_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_file_test</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">semantics_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_semantics_file_test</span>

        <span class="c1"># Set the labels to predict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">label_names</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span><span class="o">.</span><span class="n">_custom_overrides</span><span class="p">[</span><span class="s1">&#39;Labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span><span class="o">.</span><span class="n">_custom_overrides</span><span class="p">[</span><span class="s1">&#39;Labels&#39;</span><span class="p">][</span><span class="s1">&#39;label_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">label_names</span>

        <span class="c1"># Find out how many configs we need to make</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">images_train</span><span class="p">:</span>
            <span class="n">nmod</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">images_train</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nmod</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">features_train</span><span class="p">)</span>

        <span class="c1"># Create configuration files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">configs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span><span class="o">.</span><span class="n">build_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">defaultconfig</span><span class="p">())]</span> <span class="o">*</span> <span class="n">nmod</span>

        <span class="c1"># Build the fastr network</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_evaluation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">add_evaluation</span><span class="p">(</span><span class="n">label_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_label_names</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_selected_label</span><span class="p">])</span>

        <span class="c1"># Set the sources and sinks and execute the experiment.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimpleWORC.binary_classification"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.binary_classification">[docs]</a>    <span class="k">def</span> <span class="nf">binary_classification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">scoring_method</span><span class="o">=</span><span class="s1">&#39;f1_weighted&#39;</span><span class="p">,</span>
                              <span class="n">coarse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tell WORC do to a binary classification experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estimators: list</span>
<span class="sd">            List of strings with names of valid estimators. See the</span>
<span class="sd">            :ref:`WORC Config chapter &lt;config-chapter&gt;` for allowed options.</span>

<span class="sd">            If coarse, only an SVM will be used. If not, the default full</span>
<span class="sd">            config will be used.</span>
<span class="sd">        scoring_method: string, default f1</span>
<span class="sd">            Name of the scoring method used to rank the workflows. See the</span>
<span class="sd">            :ref:`WORC Config chapter &lt;config-chapter&gt;` for allowed options.</span>
<span class="sd">        coarse: boolean, default True</span>
<span class="sd">            Determine whether to do a coarse or full experiment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coarse</span> <span class="ow">and</span> <span class="n">estimators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVM&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">estimators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;RF&#39;</span><span class="p">,</span> <span class="s1">&#39;LR&#39;</span><span class="p">,</span> <span class="s1">&#39;LDA&#39;</span><span class="p">,</span> <span class="s1">&#39;QDA&#39;</span><span class="p">,</span> <span class="s1">&#39;GaussianNB&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_and_validate_estimators</span><span class="p">(</span><span class="n">estimators</span><span class="p">,</span> <span class="n">scoring_method</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">,</span> <span class="n">coarse</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.regression"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.regression">[docs]</a>    <span class="k">def</span> <span class="nf">regression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimators</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scoring_method</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">coarse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tell WORC do to a regression experiment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        estimators: list</span>
<span class="sd">            List of strings with names of valid estimators. See the</span>
<span class="sd">            :ref:`WORC Config chapter &lt;config-chapter&gt;` for allowed options.</span>

<span class="sd">            If coarse, only SVR will be used. If not, the default full</span>
<span class="sd">            config will be used.</span>
<span class="sd">        scoring_method: string, default r2</span>
<span class="sd">            Name of the scoring method used to rank the workflows. See the</span>
<span class="sd">            :ref:`WORC Config chapter &lt;config-chapter&gt;` for allowed options.</span>
<span class="sd">        coarse: boolean, default True</span>
<span class="sd">            Determine whether to do a coarse or full experiment.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coarse</span> <span class="ow">and</span> <span class="n">estimators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVR&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">estimators</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">estimators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SVR&#39;</span><span class="p">,</span> <span class="s1">&#39;RFR&#39;</span><span class="p">,</span> <span class="s1">&#39;ElasticNet&#39;</span><span class="p">,</span> <span class="s1">&#39;Lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;SGDR&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_and_validate_estimators</span><span class="p">(</span><span class="n">estimators</span><span class="p">,</span> <span class="n">scoring_method</span><span class="p">,</span> <span class="s1">&#39;regression&#39;</span><span class="p">,</span> <span class="n">coarse</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.survival"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.survival">[docs]</a>    <span class="k">def</span> <span class="nf">survival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimators</span><span class="p">,</span> <span class="n">scoring_method</span><span class="p">,</span> <span class="n">coarse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tell WORC do to a regression experiment. Not implemented yet.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="SimpleWORC.add_config_overrides"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.add_config_overrides">[docs]</a>    <span class="k">def</span> <span class="nf">add_config_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add manual overrides for the WORC configuration.</span>

<span class="sd">        For a full list of options, see the</span>
<span class="sd">        :ref:`WORC Config chapter &lt;config-chapter&gt;` for allowed options.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        config: dictionary</span>
<span class="sd">            Determine which options to override with which values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config_builder</span><span class="o">.</span><span class="n">custom_config_overrides</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div>

<div class="viewcode-block" id="SimpleWORC.add_evaluation"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.add_evaluation">[docs]</a>    <span class="k">def</span> <span class="nf">add_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">selected_label</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add the evaluation workflow to the standard WORC workflow.</span>

<span class="sd">        Adds several evaluation measures, including:</span>

<span class="sd">        - Computation of 95% confidence intervals for performance</span>
<span class="sd">        - Univariate testing of features</span>
<span class="sd">        - ROC curve with confidence bands construction</span>
<span class="sd">        - Ranking of patients based on percentage / posterior</span>
<span class="sd">        - Decompositions (e.g. PCA, t-SNE)</span>

<span class="sd">        See the :ref:`WORC documentation &lt;additonalfunctionality-chapter&gt;` for additional info.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        selected_label: integer, default 0</span>
<span class="sd">            Determine for which of the labels to be predicted the evaluate workflow</span>
<span class="sd">            should be executed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_evaluation</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selected_label</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="SimpleWORC.set_tmpdir"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.set_tmpdir">[docs]</a>    <span class="k">def</span> <span class="nf">set_tmpdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a directory for storing temporary files from the experiment.</span>

<span class="sd">        If not specified, the default fastr tmpdir is used, see ``fastr.config.mounts[&#39;tmp&#39;]`` .</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">fastr_tmpdir</span> <span class="o">=</span> <span class="n">tmpdir</span></div>

<div class="viewcode-block" id="SimpleWORC.set_multicore_execution"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.set_multicore_execution">[docs]</a>    <span class="k">def</span> <span class="nf">set_multicore_execution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;Execute experiment in multicore mode.</span>

<span class="sd">        By default, SimpleWORC executes experiments in LinearExecution mode, meaning that</span>
<span class="sd">        only a single core will be used and jobs are executed in series. When multicore mode</span>
<span class="sd">        is enabled, jobs are parallellized over all available cores, which majorly speeds</span>
<span class="sd">        up the computation.</span>

<span class="sd">        Note: SimpleWORC has an automatic detector for the BIGR and Cartesius cluster. Hence,</span>
<span class="sd">        on those clusters, do not use the multicore execution, as this will overwrite</span>
<span class="sd">        the changes applied by the detectors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worc</span><span class="o">.</span><span class="n">fastr_plugin</span> <span class="o">=</span> <span class="s1">&#39;ProcessPoolExecution&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_config_overrides</span><span class="p">({</span><span class="s1">&#39;Classification&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fastr_plugin&#39;</span><span class="p">:</span> <span class="s1">&#39;ProcessPoolExecution&#39;</span><span class="p">}})</span></div>

<div class="viewcode-block" id="SimpleWORC.features_from_radiomix_xlsx"><a class="viewcode-back" href="../../../autogen/WORC.facade.html#WORC.facade.simpleworc.SimpleWORC.features_from_radiomix_xlsx">[docs]</a>    <span class="k">def</span> <span class="nf">features_from_radiomix_xlsx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use a feature file which is generated by the OncoRadiomics Radiomix tool.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_radiomix_feature_file</span> <span class="o">=</span> <span class="n">feature_file</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016 -- 2020, Biomedical Imaging Group Rotterdam, Departments of Medical Informatics and Radiology, Erasmus MC, Rotterdam, The Netherlands

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>