(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{74:function(e,t,n){"use strict";(function(e){var i=n(13),a=n(16),r=n(5),o=n.n(r),c=n(8),s=n(1),l=n(4),u=n(2),d=n(3),v=n(28),f=n(0),p=n.n(f),b=n(54),j=n(63),h=n(114),g=n(75),m=n(76),O=function(e){return"RECVONLY"===e||"SENDONLY"===e||"SENDRECV"===e},x=function(e){return e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))},y=function(t){Object(u.a)(r,t);var n=Object(d.a)(r);function r(t){var l;return Object(s.a)(this,r),(l=n.call(this,t)).pc=void 0,l.videoRef=void 0,l.audioRef=void 0,l.processAnswerInner=function(){var e=Object(c.a)(o.a.mark((function e(t,n){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=JSON.parse(n),console.log("Receive answer sdpOffer",i),e.next=4,t.setRemoteDescription(i);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l.processAnswer=function(e,t){l.processAnswerInner(e,t).then((function(){console.log("Remote description is set")})).finally((function(){return l.setState({signaling:!1})}))},l.startInner=Object(c.a)(o.a.mark((function e(){var t,n,i,r,c,s,u,d,f,p,b,j;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.props.args.mode,O(n)){e.next=3;break}throw new Error("Invalid mode ".concat(n));case 3:if(l.setState({signaling:!0,hasVideo:!1,hasAudio:!1,error:null}),i=(null===(t=l.props.args.settings)||void 0===t?void 0:t.rtc_configuration)||{},console.log("RTCConfiguration:",i),r=new RTCPeerConnection(i),"SENDRECV"!==n&&"RECVONLY"!==n||r.addEventListener("track",(function(e){if("video"===e.track.kind){var t=l.videoRef.current;if(null==t)return void console.error("video element is not mounted");t.srcObject=e.streams[0],l.setState({hasVideo:!0})}else{var n=l.audioRef.current;if(null==n)return void console.error("audio element is not mounted");n.srcObject=e.streams[0],l.setState({hasAudio:!0})}})),"SENDRECV"!==n&&"SENDONLY"!==n){e.next=28;break}if(s=null===(c=l.props.args.settings)||void 0===c?void 0:c.media_stream_constraints,u=!s||s.audio,d=!s||s.video,f={},u&&(f.audio=!l.state.audioInput||{deviceId:l.state.audioInput.deviceId}),d&&(f.video=!l.state.videoInput||{deviceId:l.state.videoInput.deviceId}),console.log("MediaStreamConstraints:",f),!f.audio&&!f.video){e.next=25;break}if(null!=navigator.mediaDevices){e.next=19;break}throw new Error("navigator.mediaDevices is undefined. It seems the current document is not loaded securely.");case 19:if(null!=navigator.mediaDevices.getUserMedia){e.next=21;break}throw new Error("getUserMedia is not implemented in this browser");case 21:return e.next=23,navigator.mediaDevices.getUserMedia(f);case 23:(p=e.sent).getTracks().forEach((function(e){r.addTrack(e,p)}));case 25:if("SENDONLY"===n){b=Object(a.a)(r.getTransceivers());try{for(b.s();!(j=b.n()).done;)j.value.direction="sendonly"}catch(o){b.e(o)}finally{b.f()}}e.next=29;break;case 28:"RECVONLY"===n&&(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}));case 29:l.setState({playing:!0}),console.log("transceivers",r.getTransceivers()),x(r).then((function(e){null!=e?(console.log("Send sdpOffer",e.toJSON()),v.a.setComponentValue({sdpOffer:e.toJSON(),playing:!0})):console.warn("Failed to create an offer SDP")})),l.pc=r;case 33:case"end":return e.stop()}}),e)}))),l.start=function(){l.startInner().catch((function(e){return l.setState({signaling:!1,error:e})}))},l.stopInner=Object(c.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.pc,l.pc=void 0,l.setState({playing:!1},(function(){return v.a.setComponentValue({playing:!1})})),null!=t){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 8:case"end":return e.stop()}}),e)}))),l.stop=function(){l.setState({stopping:!0}),l.stopInner().finally((function(){l.setState({stopping:!1,hasVideo:!1,hasAudio:!1})}))},l.handleDeviceSelect=function(e,t){l.setState({videoInput:e,audioInput:t})},l.render=function(){var t=l.props.disabled||l.state.signaling||l.state.stopping,n=l.props.args.mode,a=O(n)&&function(e){return"SENDRECV"===e||"RECVONLY"===e}(n);return Object(i.jsxs)(b.a,{children:[l.state.error&&Object(i.jsxs)(h.a,{severity:"error",children:[l.state.error.name,": ",l.state.error.message]}),Object(i.jsxs)(g.a,{visible:a,onVisibilityChange:function(){return e(v.a.setFrameHeight)},children:[Object(i.jsx)(b.a,{children:Object(i.jsx)("video",{style:{width:"100%"},ref:l.videoRef,autoPlay:!0,controls:!0,onCanPlay:function(){return v.a.setFrameHeight()}})}),Object(i.jsx)(b.a,{children:Object(i.jsx)("audio",{ref:l.audioRef,autoPlay:!0,controls:!0})})]}),Object(i.jsxs)(b.a,{display:"flex",justifyContent:"space-between",children:[l.state.playing?Object(i.jsx)(j.a,{variant:"contained",onClick:l.stop,disabled:t,children:"Stop"}):Object(i.jsx)(j.a,{variant:"contained",color:"primary",onClick:l.start,disabled:t,children:"Start"}),Object(i.jsx)(m.a,{onSelect:l.handleDeviceSelect,value:{video:l.state.videoInput,audio:l.state.audioInput}})]})]})},l.videoRef=p.a.createRef(),l.audioRef=p.a.createRef(),l.state={signaling:!1,playing:!1,stopping:!1,videoInput:null,audioInput:null,hasVideo:!1,hasAudio:!1,error:null},l}return Object(l.a)(r,[{key:"componentDidUpdate",value:function(){if(null!=this.pc){var e=this.pc;if(null==e.remoteDescription){var t=this.props.args.sdp_answer_json;t&&this.processAnswer(e,t)}}}}]),r}(v.b);t.a=Object(v.c)(y)}).call(this,n(73).setImmediate)},75:function(e,t,n){"use strict";var i=n(13),a=n(15),r=n(45),o=n(0),c=n.n(o),s=function(e){var t,n=e.visible,c=void 0===n||n,s=e.onVisibilityChange,l=Object(r.a)(e,["visible","onVisibilityChange"]);return Object(o.useEffect)((function(){s(c)}),[c,s]),Object(i.jsx)("div",Object(a.a)({style:Object(a.a)(Object(a.a)({},l.style),{},{display:c?null===(t=l.style)||void 0===t?void 0:t.display:"none"})},l))};t.a=c.a.memo(s)},76:function(e,t,n){"use strict";(function(e){var i=n(16),a=n(13),r=n(14),o=n(0),c=n.n(o),s=n(28),l=n(54),u=n(106),d=n(63),v=n(67),f=n(82),p=n(81),b=n(116),j=n(110),h=n(109),g=Object(u.a)((function(e){return{paper:{padding:e.spacing(2)},formControl:{maxWidth:"80vw",margin:e.spacing(1),minWidth:120,display:"flex"},formButtonControl:{margin:e.spacing(2),marginBottom:e.spacing(1),minWidth:120,display:"flex"},selectEmpty:{marginTop:e.spacing(2)}}})),m=function(t){var n=t.labelId,i=t.value,r=t.devices,c=t.onChange,s=g(),l=Object(o.useCallback)((function(e){var t=r.find((function(t){return t.deviceId===e.target.value}));c(t||null)}),[r,c]);return 0===r.length?Object(a.jsx)(p.a,{value:"",disabled:!0,children:Object(a.jsx)("option",{"aria-label":"None",value:""})}):null==i?(e((function(){return c(r[0])})),null):Object(a.jsx)(p.a,{labelId:n,value:i.deviceId,onChange:l,className:s.selectEmpty,children:r.map((function(e){return Object(a.jsx)(b.a,{value:e.deviceId,children:e.label},e.deviceId)}))})},O=function(e){var t=e.open,n=e.anchorEl,i=e.value,c=e.devicesMap,l=e.onSubmit,u=Object(o.useState)(null),p=Object(r.a)(u,2),b=p[0],O=p[1],x=Object(o.useState)(null),y=Object(r.a)(x,2),S=y[0],C=y[1];Object(o.useEffect)((function(){O(c.video.find((function(e){var t;return e.deviceId===(null===(t=i.video)||void 0===t?void 0:t.deviceId)}))||null),C(c.audio.find((function(e){var t;return e.deviceId===(null===(t=i.audio)||void 0===t?void 0:t.deviceId)}))||null)}),[c,i]);var I=Object(o.useCallback)((function(e){e.preventDefault(),l(b,S)}),[l,b,S]),E=g(),w=Object(o.useRef)(),k=Object(o.useCallback)((function(e){if(e)setTimeout((function(){var t=document.getElementsByTagName("body")[0];w.current=t.style.height;var n=window.getComputedStyle(e),i=new WebKitCSSMatrix(n.transform).m42+e.getBoundingClientRect().height;i>document.body.scrollHeight&&(t.style.height="".concat(i,"px"),s.a.setFrameHeight())}),0);else{var t=document.getElementsByTagName("body")[0];null!=w.current&&(t.style.height=w.current),s.a.setFrameHeight()}}),[]);return Object(a.jsx)(j.a,{ref:k,open:t,anchorEl:n,placement:"left-end",children:Object(a.jsx)(h.a,{className:E.paper,children:Object(a.jsxs)("form",{onSubmit:I,children:[Object(a.jsxs)(v.a,{className:E.formControl,children:[Object(a.jsx)(f.a,{id:"video-input-select",children:"Video input"}),Object(a.jsx)(m,{labelId:"video-input-select",devices:c.video,value:b,onChange:O})]}),Object(a.jsxs)(v.a,{className:E.formControl,children:[Object(a.jsx)(f.a,{id:"audio-input-select",children:"Audio input"}),Object(a.jsx)(m,{labelId:"audio-input-select",devices:c.audio,value:S,onChange:C})]}),Object(a.jsx)(v.a,{className:E.formButtonControl,children:Object(a.jsx)(d.a,{type:"submit",variant:"contained",color:"primary",children:"OK"})})]})})})},x=function(e){var t=e.value,n=e.onSelect,s=Object(o.useState)(!1),u=Object(r.a)(s,2),v=u[0],f=u[1],p=c.a.useState(null),b=Object(r.a)(p,2),j=b[0],h=b[1],g=Object(o.useState)(),m=Object(r.a)(g,2),x=m[0],y=m[1],S=Object(o.useState)(!1),C=Object(r.a)(S,2),I=C[0],E=C[1],w=Object(o.useCallback)((function(e){var t,n;if(h(e.currentTarget),"function"!==typeof(null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.enumerateDevices))return y(void 0),void E(!0);navigator.mediaDevices.enumerateDevices().then((function(e){var t,n=[],a=[],r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;"videoinput"===o.kind?n.push(o):"audioinput"===o.kind&&a.push(o)}}catch(c){r.e(c)}finally{r.f()}y({video:n,audio:a}),f(!0)}))}),[]),k=Object(o.useCallback)((function(){return f(!1)}),[]),N=Object(o.useCallback)((function(e,t){y(void 0),f(!1),n(e,t)}),[n]);return Object(a.jsxs)(l.a,{children:[I&&Object(a.jsx)("p",{children:"Unavailable"}),x&&Object(a.jsx)(O,{open:v,anchorEl:j,value:t,devicesMap:x,onSubmit:N}),Object(a.jsx)(d.a,{onClick:v?k:w,children:"Select device"})]})};t.a=c.a.memo(x)}).call(this,n(73).setImmediate)},83:function(e,t,n){"use strict";n.r(t);var i=n(13),a=n(0),r=n.n(a),o=n(19),c=n.n(o),s=n(66),l=n(111),u=n(112),d=n(74),v=Object(s.a)({overrides:{MuiCssBaseline:{"@global":{body:{backgroundColor:"initial"}}}}});c.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsxs)(l.a,{theme:v,children:[Object(i.jsx)(u.a,{}),Object(i.jsx)(d.a,{})]})}),document.getElementById("root"))}},[[83,1,2]]]);
//# sourceMappingURL=main.dd09779a.chunk.js.map